<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>TV Channel</title>
	


	<!-- Font Awesome -->
	<link rel="stylesheet" href="css/all.css">
	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<!-- Material Design Bootstrap -->
	<link rel="stylesheet" href="css/mdb.min.css">
	<!-- Our custom styles (optional) -->
	<link rel="stylesheet" href="css/teamcs.css">
	

	<!-- CSS  -->
	<link href="css/video-js.css" rel="stylesheet">
	<link rel="icon" href="images/app_icon.png" type="image/gif" sizes="16x16">

	<style>

	.thumb{
		width:50px;
		height: 50px;
	}
	.my_card{
		margin-bottom: 20px;
	}
	.no_link{
		text-decoration: none;
	}
	#popupbox{
		display:none;
	}
	.channel_icon{
		width : 100px;
		padding : 10px;
		
	}
	.video_view{
		width : 100%;
	}
	img.flag_icon{
		width:30px;
	}
	</style>
</head>

<body class="fixed-sn white-skin">

	<!-- Main Navigation -->
	<header>
		<!-- Sidebar navigation -->
		<div id="slide-out" class="side-nav sn-bg-4 fixed">
			<ul class="custom-scrollbar">
				<!-- Logo -->
				<li class="logo-sn waves-effect py-3">
					<div class="text-center">
						<a href="#" class="pl-0">
							<img src="images/team-cs-logo.png">
						</a>
						<p style="color:black; font-size:12px; padding-top: 50px;">
							TV Channel
						<p>
					</div>
				</li>
				<!-- Side navigation links -->
				<li>
					<ul class="collapsible collapsible-accordion">
						<!-- Simple link -->
						<li> 
							<a href="#intro_section" class="collapsible-header waves-effect ui_navigation" id="developreportbtn"><i class="w-fa fas fa-chart-pie  ui_navigation"></i>Dashboard</a>
						</li>
					</ul>
				</li>
				<!-- Side navigation links -->
			</ul>
			<div class="sidenav-bg mask-strong"></div>
		</div>
		<!-- Sidebar navigation -->
		<!-- Navbar -->
		<nav class="navbar fixed-top navbar-expand-lg scrolling-navbar double-nav" id="nav_id">
			<!-- SideNav slide-out button -->
			<div class="float-left">
				 <a href="#" data-activates="slide-out" class="button-collapse">
					 <!-- <i class="fas fa-bars"></i> -->
					</a>
			</div>
			<!-- Breadcrumb -->
			<div class="breadcrumb-dn mr-auto align-center">
				<p></p>
			</div>
			<div class="title_text mr-auto align-center text-center">
				<h4 id="header_id"> TV Channel </h4>
			</div>
			<div class="d-flex change-mode">
				<!-- Navbar links -->
				<ul class="nav navbar-nav nav-flex-icons ml-auto">
				</ul>
				<!-- Navbar links -->
			</div>
		</nav>
		
	</header>
	<!-- Main Navigation -->

	<!-- Main layout -->
	<main>
		<div class="container-fluid">
			<!-- Section: Intro -->
			<section id="intro_section">
				<div class="card">
					<div class="card-body">
						<!-- Table -->
						<table class="table table-responsive">
							<thead>
								<tr>
									<th class="th-lg">Name</th>
									<th class="th-lg">Country</th>
									<th class="th-lg">Poster</th>
									<th class="th-lg">View</th>
									<th class="th-lg">Edit</th>
									<th class="th-lg">Delete</th>
								</tr>
							</thead>
							<tbody id="channelListTbody">
								<tr>
									<th scope="row">MRTV</th>
									<td>Myanmar</td>
									<td><img src="https://static.pyoneplay.com/static/channel/ch_logo_1578471575.png" class="thumb" /></td>
									<td><a href="#view_section" class="ui_navigation" onClick="onViewListner(0)"><i class="far fa-eye"></i></a></td>
									<td><a href="#"  data-toggle="modal" data-target="#newChannelModal"  onClick="onEditListener(0)"><i class="far fa-edit"></i></a></td>
									<td><a href="#" class=""><i class="far fa-trash-alt"></i></a></td>
								</tr>
							</tbody>
						</table>
						<!-- Button trigger modal -->
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newChannelModal">
							+ New Channel
						</button>
						<!-- Table -->
						<!-- Grid row -->
						<div class="row text-left">
							<!-- Grid column -->
							<!-- <div class="col-lg-4 col-md-6 mb-4">
								<button href="#department_form_section" class="btn btn-primary ui_navigation">တွက်ချက်ရန်</button>
							</div> -->
							<!-- Grid column -->
						</div>
						<!-- Grid row -->
					</div>
				</div>
					
				
			</section>
			<!-- Section: Intro -->
			<!-- Section: Intro -->
			<section id="view_section">
				<div class="card">
					<div class="card-body">
						<!-- Title -->
						<h4 class="card-title"><span id="channelNameSpan"></span></h4>
						<video id='videoElement'  class="video-js vjs-default-skin video_view"  poster="https://static.pyoneplay.com/static/channel/ch_logo_1578471575.png"  muted="muted" controls>
							<source type="application/x-mpegURL" src="https://maharlive.b-cdn.net/stream.m3u8">
						</video>
					</div>
				</div>
					
				
			</section>
			<!-- Section: View -->
		</div>
	</main>
	<!-- Main layout -->

	<!-- Footer -->
	<footer class="page-footer pt-0 mt-5 rgba-stylish-light">
		<!-- Copyright -->
		<div class="footer-copyright py-3 text-center">
			<div class="container-fluid">Developed By : <a href="#" target="_blank"> TEAM CS </a>
			</div>
		</div>
	</footer>
	<!-- Footer -->
<!-- Modal -->
<div class="modal fade" id="newChannelModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">+New Channel</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
	<!-- new channel modal form -->
	
        <!-- Form -->
        <form class="text-center" style="color: #757575;" action="#" id="newChannelForm">
		<!-- id -->
		<div class="md-form mt-3">
		    <input type="text" id="id" name="id" class="form-control" >
		    <label for="name">id</label>
		</div>
		<!-- Name -->
		<div class="md-form mt-3">
		    <input type="text" id="name" name="name" class="form-control" required>
		    <label for="name">Name</label>
		</div>
		<!-- URL -->
		<div class="md-form mt-3">
		    <input type="text" id="url" name="url" class="form-control"  required>
		    <label for="url">Streaming URL</label>
		</div>
		
		<div>Poster</div>
		<!-- Poster -->
		<div class="md-form mt-3">
		    <input type="file" id="poster" name="file" class="form-control"  required>
		</div>
		<div class="md-form mt-3">
			<select class="mdb-select md-form" name="country" id="country" required>
			<option value="" disabled selected>Country</option>
			<option value="1">Myanmar</option>
			<option value="2">Thailand</option>
		      </select>
		</div>

    
		<!-- Sign in button -->
		<button class="btn btn-outline-info btn-rounded btn-block z-depth-0 my-4 waves-effect" type="submit">Submit</button>
    
	    </form>
	    <!-- Form -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

	
	
	<!-- SCRIPTS -->
	<!-- JQuery -->
	<script src="js/jquery-3.4.1.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="js/mdb.min.js"></script>

	
	<script src="js/modernizr.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/underscore.min.js"></script>
	<script src="js/backbone.js"></script>


	<!-- Initializations -->
	<script>
		// SideNav Initialization
		    $(".button-collapse").sideNav();
		
		    var container = document.querySelector('.custom-scrollbar');
		    var ps = new PerfectScrollbar(container, {
		      wheelSpeed: 2,
		      wheelPropagation: true,
		      minScrollbarLength: 20
		    });
		
		    // Data Picker Initialization
		    //$('.datepicker').pickadate();
		
		    // Material Select Initialization
		    $(document).ready(function () {
		      
		      $('.mdb-select').material_select();
		
		      $('section').hide();
		      $("#intro_section").show();
		      // login section show
		      // all hide
		
		
		      $('.ui_navigation').click(function(){
		          var link = $(this).attr('href');
		          link = link.substring(1);
		          //alert(link);
		          $('section').hide();
		          $("#"+link).show();
		      });
		    });
		
		    // Tooltips Initialization
		    $(function () {
		      $('[data-toggle="tooltip"]').tooltip()
		    })
	</script>
	
	<!-- JS code -->
	<script src="js/videojs-contrib-hls.js"></script>
	<script src="js/video.js"></script>
	<!-- Our JavaScript -->
	<script type="text/javascript" src="js/software_store.js"></script>

	<script>

		window.channelList = [];
		function onViewListener(index){
			var channel = window.channelList[index];
			$('#videoElement source').attr('src', channel.url);
			$("#videoElement")[0].load();
			var videoElement= videojs('videoElement'); // this is id
		}
		function onEditListener(index){
			var channel = window.channelList[index];
			console.log("clicke on");
			console.log(channel);
			// assign modal id values, including model id
			$("#id").val(channel.id);
			$("#id").focus();
			$("#name").val(channel.name).focus();
			$("#url").val(channel.url).focus();
			//$("")
		}

		$(document).ready(function(){
			$("#newChannelForm").on("submit",function(e){
				e.preventDefault();
				console.log("newChannelForm is submited");
				var formdata = new FormData(this);
				formdata.append("ops_type", "register");
				var webservice_url = "../api/v1/";
				var case_endpoint = "channel/index.php";
				var endpoint = webservice_url + case_endpoint;
				$.ajax({
					url: endpoint,
					type: "post",
					data: formdata,
					cache: false,
					processData: false,
					contentType: false,
					success: function(response) {
						console.log("request success");
						console.log(response);
					},
					error: function(response) {
						console.log("network error");
						console.log(response.responseText);
					}
				});
				console.log("ajax is complete");
			});

			

			

			
			$("#channelListTbody").html("connecting...");
			var endpoint = "http://localhost/tvchannel/api/v1/channel/index.php";
			var fd = new FormData();
			fd.append("ops_type","select_all");
			$.ajax({	
				url: endpoint,
				type: "post",
				data: fd,
				cache: false,
				processData: false,
				contentType: false,
				success: function(response) {
					console.log("success ");
					console.log(response);
					var data = response.data;
					console.log(data);
					window.channelList = data;
					for(var i = 0 ; i < data.length; i++){
						console.log("hello "+i);
						console.log(data[i]);
						// append row to main table
						var html = '<tr>'+
							'<th scope="row">'+data[i]['name']+'</th>'+
							'<td>'+data[i]['country_name']+'</td>'+
							'<td><img src="'+data[i]['poster']+'" class="thumb" /></td>'+
							'<td><a href="#view_section" class="ui_navigation" onClick="onViewListener('+i+')"><i class="far fa-eye"></i></a></td>'+
							'<td><a href="#"  data-toggle="modal" data-target="#newChannelModal" onClick="onEditListener('+i+')"><i class="far fa-edit"></i></a></td>'+
							'<td><a href="#" class=""><i class="far fa-trash-alt"></i></a></td>'+
						'</tr>';
						$("#channelListTbody").append(html);
					}
				},
				error: function(response) {
					console.log("error "+JSON.stringify(response));
					$("#channelListTbody").html("no channel");
				}
			});
			
		});
	
	</script>
</body>

</html>